!function(e){function t(t){for(var r,o,s=t[0],u=t[1],c=t[2],p=0,d=[];p<s.length;p++)o=s[p],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&d.push(a[o][0]),a[o]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(e[r]=u[r]);for(l&&l(t);d.length;)d.shift()();return i.push.apply(i,c||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,s=1;s<n.length;s++){var u=n[s];0!==a[u]&&(r=!1)}r&&(i.splice(t--,1),e=o(o.s=n[0]))}return e}var r={},a={0:0},i=[];function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var s=window.webpackJsonp=window.webpackJsonp||[],u=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var l=u;i.push([72,1]),n()}({51:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.majorKeyList=["z","x","c","v","b","n","m","r","t","y","u","i","o","p"],t.majorNoteList=[174.614,195.998,220,246.942,261.626,293.665,329.628,349.228,391.995,440,493.883,523.251,587.33,659.255],t.minorKeyList=["s","d","f","h","j","5","6","7","9","0"],t.minorNoteList=[184.997,207.652,233.082,277.183,311.127,369.994,415.305,466.164,554.365,622.254],t.majorKeyFreqMap=t.majorKeyList.reduce((function(e,n,a){var i;return r(r({},e),((i={})[n]=t.majorNoteList[a],i))}),{}),t.minorKeyFreqMap=t.minorKeyList.reduce((function(e,n,a){var i;return r(r({},e),((i={})[n]=t.minorNoteList[a],i))}),{}),t.keyFreqMap=r(r({},t.majorKeyFreqMap),t.minorKeyFreqMap),t.keyList=Object.keys(t.keyFreqMap),t.PIANO_KEY_DOWN="KEY_DOWN",t.PIANO_KEY_UP="KEY_UP"},69:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SELECT_WAVE="SELECT_WAVE",t.OCTAVE_INCREMENT="OCTAVE_INCREMENT",t.OCTAVE_DECREMENT="OCTAVE_DECREMENT"},72:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),a=n(73);r.render(r.h(a.default,null),document.querySelector("#root"))},73:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),a=n(71),i=n(70),o=n(91),s=n(74),u=n(77),c=n(51),l=n(80),p=n(83),d=n(84),f=n(86);n(87);var v={};t.default=function(){var e=a.useReducer(u.default,u.pianoInitState),t=e[0],n=e[1],h=a.useReducer(s.default,s.configInitState),y=h[0],g=h[1],b=y.keyWaveMap,_=y.octaveLevel,w=y.waveForm;return a.useEffect((function(){var e=i.merge(i.fromEvent(document,"keydown"),i.fromEvent(document,"keyup")).pipe(o.share()),t=e.pipe(o.filter((function(e){return"keydown"===e.type})),o.pluck("key")),r=e.pipe(o.filter((function(e){return c.keyList.includes(e.key)}))).subscribe((function(e){var t=e.key,r=l.instruments[w];if("keydown"===e.type){n(u.pianoKeyDown(t));var a=r.play(l.key2freq(t,_));v[t]={instrument:r,freq:a}}else if("keyup"===e.type){if(n(u.pianoKeyUp(t)),v[t]){var i=v[t],o=i.instrument;a=i.freq;o.stop(a)}v[t]=null}})),a=t.pipe(o.filter((function(e){return Object.keys(b).includes(e)}))).subscribe((function(e){g(s.selectWave(b[e]))})),p=t.pipe(o.filter((function(e){return["=","-"].includes(e)}))).subscribe((function(e){switch(e){case"=":g(s.increaseOctave());break;case"-":g(s.decreaseOctave())}}));return function(){r.unsubscribe(),a.unsubscribe(),p.unsubscribe()}}),[y]),r.h("div",{id:"app"},r.h("div",{className:"window window--wave"},r.h("h2",{className:"window__header"},"Wave"),r.h("div",{className:"window__body"},r.h(f.default,{analyser:l.analyser}))),r.h("div",{className:"window window--note"},r.h("h2",{className:"window__header"},"Note"),r.h("div",{className:"window__body"},r.h(p.default,null))),r.h("div",{className:"window window--piano"},r.h("h2",{className:"window__header"},"Piano"),r.h("div",{className:"window__body"},r.h(d.default,{pianoState:t.keyPressMap}))))}},74:function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0});var a=n(75);t.default=a.default,t.configInitState=a.configInitState,r(n(76)),r(n(69))},75:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var a=n(69);t.configInitState={keyWaveMap:{1:"sine",2:"square",3:"sawtooth",4:"triangle"},waveForm:"square",octaveLevel:4};t.default=function(e,n){switch(void 0===e&&(e=t.configInitState),n.type){case a.SELECT_WAVE:return r(r({},e),{waveForm:n.payload});case a.OCTAVE_INCREMENT:return r(r({},e),{octaveLevel:Math.min(8,e.octaveLevel+1)});case a.OCTAVE_DECREMENT:return r(r({},e),{octaveLevel:Math.max(1,e.octaveLevel-1)});default:return e}}},76:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(69);t.selectWave=function(e){return{type:r.SELECT_WAVE,payload:e}},t.increaseOctave=function(){return{type:r.OCTAVE_INCREMENT}},t.decreaseOctave=function(){return{type:r.OCTAVE_DECREMENT}}},77:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(78);t.default=r.default,t.pianoInitState=r.pianoInitState,function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(79))},78:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var a=n(51);t.pianoInitState={keyPressMap:a.keyList.reduce((function(e,t){var n;return r(r({},e),((n={})[t]=!1,n))}),{})};t.default=function(e,n){var i,o;switch(void 0===e&&(e=t.pianoInitState),n.type){case a.PIANO_KEY_DOWN:return r(r({},e),{keyPressMap:r(r({},e.keyPressMap),(i={},i[n.payload]=!0,i))});case a.PIANO_KEY_UP:return r(r({},e),{keyPressMap:r(r({},e.keyPressMap),(o={},o[n.payload]=!1,o))});default:return e}}},79:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(51);t.pianoKeyDown=function(e){return{type:r.PIANO_KEY_DOWN,payload:e}},t.pianoKeyUp=function(e){return{type:r.PIANO_KEY_UP,payload:e}}},80:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(51),a=n(81);t.Synthesizer=a.Synthesizer;var i=n(82);t.Analyser=i.Analyser;t.key2freq=function(e,t){return void 0===t&&(t=4),r.keyFreqMap[e]*Math.pow(2,t-4)};var o=new(window.AudioContext||window.webkitAudioContext),s=o.createGain(),u=o.createAnalyser();s.connect(u).connect(o.destination);var c=new i.Analyser(u);t.analyser=c;var l={sine:new a.Synthesizer(o,"sine"),triangle:new a.Synthesizer(o,"triangle"),square:new a.Synthesizer(o,"square"),sawtooth:new a.Synthesizer(o,"sawtooth")};t.instruments=l,Object.values(l).forEach((function(e){e.connect(s)}))},81:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this.freqOscMap={},this.c=e,this.wave=t}return e.prototype.connect=function(e){this.output=e},e.prototype.play=function(e){if(this.freqOscMap[e])return e;var t=this.c.createOscillator();if(!this.output)throw Error("The synthesizer needs an output");return t.connect(this.output),t.type=this.wave,t.frequency.value=e,this.freqOscMap[e]=t,t.start(),e},e.prototype.stop=function(e){var t;this.freqOscMap[e]&&(null===(t=this.freqOscMap[e])||void 0===t||t.stop()),this.freqOscMap[e]=null},e}();t.Synthesizer=r},82:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.analyserNode=e}return e.prototype.getTimeDomainData=function(){var e=new Uint8Array(this.analyserNode.frequencyBinCount);return this.analyserNode.getByteTimeDomainData(e),e},e}();t.Analyser=r},83:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2);t.default=function(){return r.h("div",{className:"note"},r.h("table",null,r.h("tr",null,r.h("th",null,"Key"),r.h("th",null,"Description")),r.h("tr",null,r.h("td",null,"1"),r.h("td",null,"sine")),r.h("tr",null,r.h("td",null,"2"),r.h("td",null,"square")),r.h("tr",null,r.h("td",null,"3"),r.h("td",null,"sawtooth")),r.h("tr",null,r.h("td",null,"4"),r.h("td",null,"triangle")),r.h("tr",null,r.h("td",null,"+"),r.h("td",null,"increase octave")),r.h("tr",null,r.h("td",null,"-"),r.h("td",null,"decrease octave"))))}},84:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),a=n(85),i=n(51);t.default=function(e){var t=e.pianoState;return r.h("div",{className:"piano"},r.h("div",{className:"piano__minor"},i.minorKeyList.map((function(e){return r.h("button",{className:a.default("piano__minor-key",{active:t[e]})},e)}))),r.h("div",{className:"piano__major"},i.majorKeyList.map((function(e){return r.h("button",{className:a.default("piano__major-key",{active:t[e]})},e)}))))}},86:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),a=n(71),i=n(70);t.default=function(e){var t=e.analyser,n=a.useRef(null);return a.useEffect((function(){var e=i.interval(300).subscribe((function(){!function(e,t){var n=e.getTimeDomainData(),r=t.getContext("2d"),a=t.offsetWidth,i=t.offsetHeight;t.width=a,t.height=i,r.clearRect(0,0,a,i),r.strokeStyle="#243137",r.moveTo(0,i/2),n.forEach((function(e,t){var n=t*a/1024,o=(i-40)*(1-e/256)+20;r.lineTo(n,o)})),r.stroke()}(t,n.current)}));return function(){e.unsubscribe()}}),[]),r.h("div",{className:"wave"},r.h("div",{className:"wave__main"},r.h("canvas",{ref:n})))}},87:function(e,t,n){var r=n(88),a=n(89);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var i={insert:"head",singleton:!1};r(a,i);e.exports=a.locals||{}},89:function(e,t,n){(t=n(90)(!1)).push([e.i,'html{box-sizing:border-box;font-size:16px;font-family:"menlo","Roboto Mono","PingFang SC","Hiragino Sans GB","Heiti SC","Microsoft YaHei","WenQuanYi Micro Hei",monospace,sans-serif}body{background-color:var(--bg)}*,*:before,*:after{margin:0;padding:0;box-sizing:inherit;font-size:inherit}a{color:inherit}ol,ul{list-style:none}img{max-width:100%;height:auto}#root{display:flex;height:100vh;width:100vw;align-items:center;justify-content:center;--gb4-1: #243137;--gb4-2: #3f503f;--gb4-3: #768448;--gb4-4: #acb56b;background:var(--gb4-1)}#app{display:grid;grid-template-columns:1fr 1fr;grid-template-rows:16fr 11fr;grid-template-areas:"wave note" "piano piano";column-gap:20px;row-gap:20px;width:1000px;height:600px;padding:32px 36px 20px;color:var(--gb4-1)}button{padding:2px 20px;border:1px solid var(--gb4-2);background:var(--gb4-4);color:var(--gb4-1)}button:focus{outline:none}select{border:1px solid var(--gb4-2);background:1px solid var(--gb4-4);color:var(--gb4-1)}.window{position:relative;background:var(--gb4-4);border-radius:12px;overflow:hidden}.window__header{padding:8px;text-align:center;background-color:var(--gb4-3)}.window__body{height:calc(100% - 35px);padding:20px}.window--status{grid-area:status}.window--control{grid-area:control}.window--piano{grid-area:piano}.window--wave{grid-area:wave}.window--note{grid-area:note}.config ul{display:flex;flex-direction:column}.config ul>li+li{margin-top:10px}.config__select-wave{padding:1px}.config__control-octave>button+button{margin-left:10px}.config__info{position:relative;top:2px;text-transform:uppercase}.piano{position:relative;display:flex;flex-flow:column;height:100%}.piano button:focus{outline:none}.piano__major{display:flex;flex:2 0 auto;width:100%}.piano__minor{display:flex;flex:1 0 auto;width:100%}.piano__major-key{display:flex;padding:0;flex:1 0 0;align-items:center;justify-content:center;color:var(--gb4-4);box-shadow:2px 0 0 0 var(--gb4-3),0 2px 0 0 var(--gb4-3),2px 2px 0 0 var(--gb4-3),2px 0 0 0 var(--gb4-3) inset,0 2px 0 0 var(--gb4-3) inset;background:var(--gb4-2);border:transparent}.piano__major-key.active{background:var(--gb4-3)}.piano__minor-key{display:flex;padding:0;flex:1.5 0 0;align-items:center;justify-content:center;background:var(--gb4-1);box-shadow:2px 0 0 0 var(--gb4-3),0 2px 0 0 var(--gb4-3),2px 2px 0 0 var(--gb4-3),2px 0 0 0 var(--gb4-3) inset,0 2px 0 0 var(--gb4-3) inset;border:transparent;color:var(--gb4-4)}.piano__minor-key:nth-child(2),.piano__minor-key:nth-child(7){flex-grow:1}.piano__minor-key.active{background:var(--gb4-3)}.status{display:flex;flex-direction:column;height:100%}.status__wave{width:100%;flex:1 0 0}.status__wave canvas{width:100%;height:100%;background-color:var(--gb4-3);background-image:linear-gradient(rgba(172, 181, 107, 0.3) 1px, transparent 1px),linear-gradient(90deg, rgba(172, 181, 107, 0.3) 1px, transparent 1px);background-size:10px 10px,10px 10px;background-position:-2px -2px,-2px -2px,-1px -1px,-1px -1px}.wave{display:flex;flex-direction:column;height:100%}.wave__main{width:100%;height:100%}.wave__main canvas{width:100%;height:100%;background-color:var(--gb4-3);background-image:linear-gradient(rgba(172, 181, 107, 0.3) 1px, transparent 1px),linear-gradient(90deg, rgba(172, 181, 107, 0.3) 1px, transparent 1px);background-size:10px 10px,10px 10px;background-position:-2px -2px,-2px -2px,-1px -1px,-1px -1px}.note table{width:80%;border-spacing:4px;text-align:left;margin:25px auto}.note th{text-transform:uppercase;padding-bottom:4px}.note th:first-child{width:30%}',""]),e.exports=t}});
//# sourceMappingURL=app.77fc94747dbcc38054eb.js.map